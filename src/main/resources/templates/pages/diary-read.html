<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- 기본 스타일 -->
  <link rel="stylesheet" th:href="@{/css/base.css}">
  <!-- 폰 스타일 -->
  <link rel="stylesheet" th:href="@{/css/phone-style.css}">
  <!-- 프레임 스타일 -->
  <link rel="stylesheet" th:href="@{/css/phone-frame.css}">
  <!-- 스크롤바 스타일 -->
  <link rel="stylesheet" th:href="@{/css/scrollbar-style.css}">
  <!-- 앱 콘텐츠 스타일 -->
  <link rel="stylesheet" th:href="@{/css/app-content.css}">

  <title>일기 보기 - Feelio</title>
  <style>
    /* 기본 스타일 */
    body {
      font-family: 'Apple SD Gothic Neo', 'Malgun Gothic', sans-serif;
      background-color: #f8f9ff;
      margin: 0;
      padding: 0;
      color: #333;
    }

    /*.phone-container {*/
    /*  max-width: 375px;*/
    /*  margin: 0 auto;*/
    /*  background: white;*/
    /*  border-radius: 30px;*/
    /*  overflow: hidden;*/
    /*  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);*/
    /*  position: relative;*/
    /*}*/

    /*.app-container {*/
    /*  height: 100%;*/
    /*  display: flex;*/
    /*  flex-direction: column;*/
    /*}*/

    /*.app-header {*/
    /*  background-color: #f0f3ff;*/
    /*  padding: 20px;*/
    /*  position: relative;*/
    /*  display: flex;*/
    /*  align-items: center;*/
    /*}*/

    .back-button {
      width: 24px;
      height: 24px;
      margin-right: 12px;
    }

    .app-header h1 {
      margin: 0;
      font-size: 20px;
      color: #333;
      flex-grow: 1;
      text-align: center;
    }

    .actions-button {
      width: 24px;
      height: 24px;
    }

    .app-content {
      flex: 1;
      overflow-y: auto;
      padding: 0;
      position: relative;
    }

    /* 일기 보기 화면 스타일 */
    .diary-header {
      background-color: #fff;
      padding: 20px;
      border-bottom: 1px solid #eee;
    }

    .diary-title {
      font-size: 22px;
      font-weight: 700;
      margin: 0 0 8px 0;
    }

    .diary-meta {
      display: flex;
      align-items: center;
      flex-wrap: wrap;
      gap: 16px;
      margin-top: 12px;
    }

    .diary-date, .diary-weather, .diary-location {
      display: flex;
      align-items: center;
      font-size: 14px;
      color: #666;
    }

    .meta-icon {
      width: 18px;
      height: 18px;
      margin-right: 6px;
    }

    .emotion-tag {
      display: inline-flex;
      align-items: center;
      background-color: #f0f3ff;
      border-radius: 30px;
      padding: 6px 12px;
      margin-right: 8px;
      margin-bottom: 8px;
    }

    .emotion-emoji {
      width: 24px;
      height: 24px;
      margin-right: 6px;
    }

    .emotion-name {
      font-size: 14px;
      font-weight: 600;
      color: #5f7adb;
    }

    .photo-gallery {
      position: relative;
      height: 250px;
      overflow: hidden;
    }

    .gallery-image {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .gallery-controls {
      position: absolute;
      bottom: 16px;
      left: 0;
      right: 0;
      display: flex;
      justify-content: center;
      gap: 8px;
    }

    .gallery-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background-color: rgba(255, 255, 255, 0.5);
    }

    .gallery-dot.active {
      background-color: white;
    }

    .diary-content {
      padding: 24px 20px;
    }

    .diary-text {
      font-size: 16px;
      line-height: 1.7;
      color: #333;
      white-space: pre-wrap;
    }

    .diary-emotions {
      margin: 24px 20px;
      padding: 16px;
      background-color: #f9f9f9;
      border-radius: 12px;
    }

    .emotions-title {
      font-size: 16px;
      font-weight: 600;
      margin: 0 0 12px 0;
      color: #444;
    }

    .emotions-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    .diary-bottom {
      padding: 0 20px 24px 20px;
    }

    .section-title {
      font-size: 16px;
      font-weight: 600;
      margin: 0 0 12px 0;
      color: #444;
    }

    .music-recommendation {
      display: flex;
      align-items: center;
      background-color: #f9f9f9;
      border-radius: 12px;
      padding: 14px;
      margin-bottom: 20px;
    }

    .music-cover {
      width: 60px;
      height: 60px;
      border-radius: 8px;
      margin-right: 14px;
      object-fit: cover;
    }

    .music-info {
      flex: 1;
    }

    .music-title {
      font-size: 16px;
      font-weight: 600;
      margin: 0 0 4px 0;
    }

    .music-artist {
      font-size: 14px;
      color: #666;
      margin: 0;
    }

    .play-button {
      width: 36px;
      height: 36px;
      background-color: #5f7adb;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .play-icon {
      width: 16px;
      height: 16px;
    }

    .activity-list {
      margin-bottom: 20px;
    }

    .activity-item {
      display: flex;
      align-items: center;
      padding: 10px 0;
      border-bottom: 1px solid #eee;
    }

    .activity-icon {
      width: 24px;
      height: 24px;
      margin-right: 12px;
    }

    .activity-name {
      font-size: 15px;
    }

    .activity-duration {
      margin-left: auto;
      color: #666;
      font-size: 14px;
    }

    .health-data {
      display: flex;
      justify-content: space-between;
      margin-bottom: 20px;
    }

    .health-item {
      flex: 1;
      background-color: #f9f9f9;
      border-radius: 12px;
      padding: 14px;
      text-align: center;
      margin: 0 6px;
    }

    .health-value {
      font-size: 18px;
      font-weight: 700;
      margin: 0 0 4px 0;
    }

    .health-label {
      font-size: 13px;
      color: #666;
      margin: 0;
    }

    .actions-button-container {
      display: flex;
      justify-content: flex-end;
      gap: 12px;
      margin-top: 24px;
    }

    .action-button {
      display: flex;
      align-items: center;
      background: none;
      border: none;
      padding: 8px 12px;
      font-size: 14px;
      cursor: pointer;
      color: #5f7adb;
    }

    .action-icon {
      width: 20px;
      height: 20px;
      margin-right: 6px;
    }
  </style>
</head>
<body>
<!--diary-read.html-->
<div class="phone-container">
  <div class="app-container">
    <div class="app-header">
      <a href="javascript:history.back()" class="back-button">
        <img src="/api/placeholder/24/24" alt="뒤로가기">
      </a>
      <h1>일기 보기</h1>
    </div>

    <div class="app-content">
      <!-- 일기 헤더 - 제목, 날짜, 감정 태그 -->
      <div class="diary-header">
        <h2 class="diary-title" th:text="${diary.title}">오늘은 특별했던 하루</h2>

        <!-- 날짜, 날씨, 위치 정보 -->
        <div class="diary-meta">
          <div class="diary-date">
            <img class="meta-icon" src="/api/placeholder/18/18" alt="날짜">
            <span th:text="${#temporals.format(diary.diaryDate, 'yyyy년 MM월 dd일 E요일')}">2025년 4월 15일 화요일</span>
          </div>
          <div class="diary-weather" th:if="${diary.weather != null && !diary.weather.isEmpty()}">
            <img class="meta-icon" src="/api/placeholder/18/18" alt="날씨">
            <span th:text="${diary.weather}">맑음, 22°C</span>
          </div>
        </div>
      </div>

      <!-- 사진 갤러리 -->
      <div class="photo-gallery" th:if="${diary.existingPhotos != null && !diary.existingPhotos.isEmpty()}">
        <div th:each="photo, status : ${diary.existingPhotos}">
          <img class="gallery-image" th:src="${photo.photoUrl}" alt="일기 사진" th:style="${!status.first} ? 'display: none;' : ''">
        </div>
        <div class="gallery-controls" th:if="${diary.existingPhotos.size() > 1}">
          <div th:each="photo, status : ${diary.existingPhotos}"
               class="gallery-dot"
               th:classappend="${status.first} ? 'active' : ''">
          </div>
        </div>
      </div>

      <!-- 일기 본문 내용 -->
      <div class="diary-content">
        <p class="diary-text" th:text="${diary.content}">오늘은 정말 특별한 하루였다. 오랫동안 준비했던 프로젝트 발표가 있었는데, 생각보다 훨씬 좋은 반응을 얻었다. 팀원들과 함께 열심히 준비한 보람이 있었다.

          발표 후에는 팀원들과 함께 맛있는 저녁을 먹으며 그동안의 노력을 서로 치하했다. 앞으로도 이런 기회가 더 많았으면 좋겠다. 다음 프로젝트는 어떤 주제로 할지 벌써부터 기대된다.

          집에 돌아와서는 잠시 책을 읽으며 하루를 마무리했다. 오늘처럼 보람찬 날이 더 많아졌으면 좋겠다.</p>
      </div>

      <!-- 감정 분석 결과 -->
      <div class="diary-emotions" th:if="${diary.emotionAnalysis != null && diary.emotionAnalysis.emotions != null && !diary.emotionAnalysis.emotions.isEmpty()}">
        <h3 class="emotions-title">감정 분석 결과</h3>
        <div class="emotions-tags">
          <div class="emotion-tag" th:each="emotion : ${diary.emotionAnalysis.emotions}">
            <img class="emotion-emoji" th:src="${emotion.emotionEmoji}" alt="감정" th:alt="${emotion.emotionName}">
            <span class="emotion-name" th:text="${emotion.emotionName + ' ' + emotion.percentage + '%'}">행복 45%</span>
          </div>
        </div>
      </div>

      <!-- 일기 하단 정보 -->
      <div class="diary-bottom">
        <!-- 음악 추천 -->
        <h3 class="section-title" th:if="${diary.recommendedMusic != null}">오늘의 음악</h3>
        <div class="music-recommendation" th:if="${diary.recommendedMusic != null}">
          <img class="music-cover" src="/resources/static/images/music-cover.jpg" alt="음악 커버">
          <div class="music-info">
            <h4 class="music-title" th:text="${diary.recommendedMusic.title}">On the Ground</h4>
            <p class="music-artist" th:text="${diary.recommendedMusic.artist}">ROSÉ</p>
          </div>
          <a class="play-button" th:if="${diary.recommendedMusic.spotifyLink != null}" th:href="${diary.recommendedMusic.spotifyLink}" target="_blank">
            <img class="play-icon" src="/api/placeholder/16/16" alt="재생">
          </a>
          <button class="play-button" th:unless="${diary.recommendedMusic.spotifyLink != null}">
            <img class="play-icon" src="/api/placeholder/16/16" alt="재생">
          </button>
        </div>

        <!-- 활동 정보 -->
        <h3 class="section-title" th:if="${diary.emotionAnalysis != null && diary.emotionAnalysis.activityRecommendations != null && !diary.emotionAnalysis.activityRecommendations.isEmpty()}">오늘의 활동</h3>
        <div class="activity-list" th:if="${diary.emotionAnalysis != null && diary.emotionAnalysis.activityRecommendations != null && !diary.emotionAnalysis.activityRecommendations.isEmpty()}">
          <div class="activity-item" th:each="activity : ${diary.emotionAnalysis.activityRecommendations}">
            <img class="activity-icon" src="/api/placeholder/24/24" alt="활동">
            <span class="activity-name" th:text="${activity.activity}">프로젝트 발표</span>
          </div>
        </div>

        <!-- 액션 버튼 -->
        <div class="actions-button-container">
          <a class="action-button" th:href="@{/diary/edit/{id}(id=${diary.id})}">
            <img class="action-icon" src="/api/placeholder/20/20" alt="편집">
            <span>수정하기</span>
          </a>
          <button class="action-button" id="toggleBookmark" th:data-diary-id="${diary.id}" th:data-is-bookmarked="${diary.bookmarked}">
            <img class="action-icon" src="/api/placeholder/20/20" alt="북마크">
            <span th:text="${diary.bookmarked ? '북마크 해제' : '북마크하기'}">북마크하기</span>
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- 푸터 프래그먼트 포함 -->
<div th:replace="~{fragments/footer :: footer}"></div>

<!-- 프레임 컨테이너 - 항상 최상위에 위치 -->
<div class="frame-container">
  <div class="phone-frame"></div>
</div>

<!-- 그림자 효과 -->
<div class="phone-shadow"></div>

<!-- 북마크 기능 자바스크립트 -->
<script th:inline="javascript">
  document.addEventListener('DOMContentLoaded', function() {
    const toggleBookmarkBtn = document.getElementById('toggleBookmark');
    if (toggleBookmarkBtn) {
      toggleBookmarkBtn.addEventListener('click', function() {
        const diaryId = this.getAttribute('data-diary-id');

        fetch(`/api/diary/${diaryId}/bookmark`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          }
        })
                .then(response => {
                  if (response.ok) {
                    // 북마크 상태 토글
                    const isCurrentlyBookmarked = this.getAttribute('data-is-bookmarked') === 'true';
                    this.setAttribute('data-is-bookmarked', !isCurrentlyBookmarked);
                    this.querySelector('span').textContent = !isCurrentlyBookmarked ? '북마크 해제' : '북마크하기';
                  }
                })
                .catch(error => {
                  console.error('북마크 토글 오류:', error);
                });
      });
    }
  });
</script>

<!-- 사진 갤러리 기능 자바스크립트 -->
<script>
  document.addEventListener('DOMContentLoaded', function() {
    // 사진 갤러리 관련 요소들 가져오기
    const galleryImages = document.querySelectorAll('.gallery-image');
    const galleryDots = document.querySelectorAll('.gallery-dot');

    if (galleryImages.length > 1 && galleryDots.length > 1) {
      // 각 도트에 클릭 이벤트 추가
      galleryDots.forEach((dot, index) => {
        dot.addEventListener('click', () => {
          // 모든 이미지 숨기기
          galleryImages.forEach(img => {
            img.style.display = 'none';
          });

          // 선택한 이미지만 표시
          galleryImages[index].style.display = 'block';

          // 모든 도트에서 active 클래스 제거
          galleryDots.forEach(d => {
            d.classList.remove('active');
          });

          // 선택한 도트에 active 클래스 추가
          dot.classList.add('active');
        });
      });
    }
  });
</script>
</body>
</html>